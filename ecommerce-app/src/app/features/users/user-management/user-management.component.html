<div class="bg-white shadow rounded-lg p-6">
  <h2 class="text-xl font-semibold text-gray-800 mb-4">Manage Users</h2>

  <!-- Search -->
  <div class="flex items-center gap-2 mb-4">
    <input
      type="text"
      [(ngModel)]="searchText"
      (input)="filterUsers()"
      placeholder="Search by name or email..."
      class="border border-gray-300 rounded-md px-3 py-1.5 text-sm focus:ring-2 focus:ring-indigo-400 focus:outline-none w-64"
    />
  </div>

  <!-- Loader -->
  <div *ngIf="loading" class="text-center py-10 text-gray-500">
    Loading users...
  </div>

  <!-- Users Table -->
  <table
    *ngIf="!loading && filteredUsers.length"
    class="min-w-full border border-gray-200 text-sm rounded-md overflow-hidden"
  >
    <thead class="bg-gray-100">
      <tr>
        <th class="py-2 px-4 text-left">Id</th>
        <th class="py-2 px-4 text-left">Name</th>
        <th class="py-2 px-4 text-left">Email</th>
        <th class="py-2 px-4 text-left">Phone</th>
        <th class="py-2 px-4 text-left">Role</th>
        <th class="py-2 px-4 text-center">Status</th>
        <th class="py-2 px-4 text-center">Actions</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let user of filteredUsers" class="border-t hover:bg-gray-50 transition-all">
        
        <td class="py-2 px-4 font-medium text-gray-800">{{ user.id |uppercase}}</td>
        <td class="py-2 px-4 font-medium text-gray-800">{{ user.name }}</td>
        <td class="py-2 px-4 text-gray-700">{{ user.email }}</td>
        <td class="py-2 px-4">{{ user.phone || '-' }}</td>
        <td class="py-2 px-4 capitalize">{{ user.role }}</td>

        <td class="py-2 px-4 text-center">
          <span
            [ngClass]="user['isBlocked'] ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'"
            class="px-3 py-1 rounded-full text-xs font-semibold"
          >
            {{ user['isBlocked'] ? 'Blocked' : 'Active' }}
          </span>
        </td>

        <!-- Actions -->
        <td class="py-2 px-4 text-center space-x-3">
          <button
            (click)="toggleBlock(user)"
            [ngClass]="user['isBlocked'] ? 'text-green-600' : 'text-red-600'"
          >
            <i [class]="user['isBlocked'] ? 'fa-solid fa-unlock' : 'fa-solid fa-ban'"></i>
          </button>

          <button
            (click)="viewUser(user)"
            class="text-blue-600 hover:text-blue-800"
          >
            <i class="fa-solid fa-eye"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="!loading && !filteredUsers.length" class="text-center py-10 text-gray-500">
    No users found.
  </div>
</div>

<!-- USER + ORDERS MODAL -->
<div *ngIf="selectedUser" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white w-[500px] rounded-lg shadow-lg p-6 relative">

    <button (click)="closeModal()" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600">
      <i class="fa-solid fa-xmark"></i>
    </button>

    <h3 class="text-lg font-semibold mb-2">User Details</h3>

    <div class="text-sm space-y-1">
      <p><strong>Name:</strong> {{ selectedUser.name }}</p>
      <p><strong>Email:</strong> {{ selectedUser.email }}</p>
      <p><strong>Phone:</strong> {{ selectedUser.phone || '-' }}</p>
      <p><strong>Role:</strong> {{ selectedUser.role }}</p>
      <p><strong>Status:</strong> {{ selectedUser['isBlocked'] ? 'Blocked' : 'Active' }}</p>
    </div>

    <hr class="my-4">

    <h4 class="font-semibold mb-2">User Orders</h4>

    <div *ngIf="!userOrders.length" class="text-gray-500 text-sm">
      No orders found for this user.
    </div>

    <div *ngFor="let order of userOrders" class="border rounded p-2 mb-2 text-sm">
      <p><strong>Order ID:</strong> {{ order.id }}</p>
      <p><strong>Total:</strong> â‚¹{{ order.total }}</p>
      <p><strong>Date:</strong> {{ order.date }}</p>
    </div>

  </div>
</div>
